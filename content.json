{"meta":{"title":"Mengqiu Chen","subtitle":"Blog of a human developer","description":"Learning is not enough, you must apply","author":"Roger Chen","url":"https://mengqiu.me","root":"/"},"pages":[{"title":"About","date":"2022-01-24T00:04:21.000Z","updated":"2022-02-22T20:19:54.199Z","comments":true,"path":"about/index.html","permalink":"https://mengqiu.me/about/","excerpt":"","text":"This is the blog of Mengqiu (Roger) Chen. This blog will record the learning path along becoming web developer. Roger is a backend developer base in Calgary. He has background knowledge of natural resouce conservation. With multiple industrial experiences, he eagers to apply them with programming skills. Programming languages: Java JavaScript Backend: Servlet Spring Boot Node.js Express Database: MySQL Oracle MongoDB Hibernate MyBatis Sequelize Frontend: JSP Thymleaf BootStrap Testing: JUnit Selenium Postman Mockito"},{"title":"Categories","date":"2022-01-23T23:32:11.000Z","updated":"2022-01-23T23:33:46.447Z","comments":true,"path":"categories/index.html","permalink":"https://mengqiu.me/categories/","excerpt":"","text":""},{"title":"Tags","date":"2022-01-23T23:32:47.000Z","updated":"2022-01-23T23:33:40.684Z","comments":true,"path":"tags/index.html","permalink":"https://mengqiu.me/tags/","excerpt":"","text":""}],"posts":[{"title":"Some configurations of TypeScript project in VSCode","slug":"Some-configurations-of-TypeScript-project-in-VSCode","date":"2022-04-12T15:14:03.000Z","updated":"2022-04-14T01:23:57.783Z","comments":true,"path":"2022/04/12/Some-configurations-of-TypeScript-project-in-VSCode/","link":"","permalink":"https://mengqiu.me/2022/04/12/Some-configurations-of-TypeScript-project-in-VSCode/","excerpt":"This post is about some configurations for TypeScript project in VSCode","text":"This post is about some configurations for TypeScript project in VSCode Install typescript globally:1npm install typescript -g init TypeScript config:1npm run compile -- --init watch application package for changes. Add new line to scripts of package.json file1234&quot;scripts&quot;:&#123; &quot;tsc&quot;:&quot;tsc&quot;, &quot;watch&quot;:&quot;tsc --watch&quot;&#125; reload browser for changes:1npm install browser-sync--save-dev Add script:1&quot;serve&quot;:&quot;browser-sync start --server --watch&quot; Debugger configurations: launch application in chrome through port 3000 123456789&quot;configurations&quot;: [ &#123; &quot;type&quot;: &quot;chrome&quot;, &quot;request&quot;: &quot;launch&quot;, &quot;name&quot;: &quot;Launch against localhost&quot;, &quot;url&quot;: &quot;http://localhost:3000&quot;, &quot;webRoot&quot;: &quot;$&#123;workspaceFolder&#125;&quot; &#125;, ]","categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"}],"tags":[{"name":"TypeScript","slug":"TypeScript","permalink":"https://mengqiu.me/tags/TypeScript/"},{"name":"VSCode","slug":"VSCode","permalink":"https://mengqiu.me/tags/VSCode/"}]},{"title":"Mail in Node.js","slug":"Mail-in-Node-js","date":"2022-03-04T18:11:45.000Z","updated":"2022-03-04T18:12:33.492Z","comments":true,"path":"2022/03/04/Mail-in-Node-js/","link":"","permalink":"https://mengqiu.me/2022/03/04/Mail-in-Node-js/","excerpt":"Sending mail helps communicate with users of website. We can use nodemailer and SenderGrid in our project to send email.","text":"Sending mail helps communicate with users of website. We can use nodemailer and SenderGrid in our project to send email. Install nodemailer and SendGrid1npm install nodemailer nodemailer-sendgrid-transport We need register an account with SendGrid. Then generate an api key with full access. Add middleware12345678const nodemailer = require(&#x27;nodemailer&#x27;);const sendgridTransport = require(&#x27;nodemailer-sendgrid-transport&#x27;);const transpoerter = nodemailer.createTransport(sendgridTransport(&#123; auth: &#123; api_key: &#x27;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&#x27; &#125;&#125;)); To send email: 123456transpoerter.sendMail(&#123; to: email, from: &#x27;yanmiao1992@hotmail.com&#x27;, subject: &#x27;Signup succeeded&#x27;, html: &#x27;&lt;h1&gt;You successfully signed up!&lt;/h1&gt;&#x27;&#125;); This will return a promise","categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"}],"tags":[{"name":"Node.js","slug":"Node-js","permalink":"https://mengqiu.me/tags/Node-js/"},{"name":"Email","slug":"Email","permalink":"https://mengqiu.me/tags/Email/"}]},{"title":"Authentication in Node.js","slug":"Authentication-in-Node-js","date":"2022-03-03T19:15:13.000Z","updated":"2022-03-03T19:16:37.723Z","comments":true,"path":"2022/03/03/Authentication-in-Node-js/","link":"","permalink":"https://mengqiu.me/2022/03/03/Authentication-in-Node-js/","excerpt":"Authentication is important in web application. The typical way is using username and password. We also need more security features to protect users credentials","text":"Authentication is important in web application. The typical way is using username and password. We also need more security features to protect users credentials Password hashingPassword should never be saved as plain text in database. We should hash or encrypt the passwords. To achieve this, we use bcryptjs 1npm install bcryptjs To hash a password: 123456789cosnt bcrypt = require(&#x27;bcryptjs&#x27;);bcrypt.hash(password, 12) // 12 is the round of hashing. Higher is more secure but need more computing time. .then(hashedPassword =&gt; &#123; user = new User(&#123; email: email, password: hashedPassword &#125;) user.save();&#125;); Protecting routeWe need middleware to protect our routes so unauthorized access through path can be prevented. For example, we can create a middleware called is-auth: 123456module.exports = (req, res, next) =&gt; &#123; if (!req.session.isLoggedIn) &#123; return res.redirect(&#x27;/login&#x27;); &#125; next();&#125; This middleware will check if the request has a session with isLoggedIn, if it doesn’t have, then redirect response to /login, else, go to next middleware. Then we can use this middleware in our routes: 1router.get(&#x27;/add-product&#x27;, isAuth, adminController.getAddProduct); In this router, request reaches /add-product first, then the server check if it’s authenticated with isAuth middleware. If it is, then goes to adminController.getAddProduct. If it’s not, then it’s redirected to /login as mentioned above. CSRF token to protect against malicious requestFor CSRF, check: Cross Site Request Forgery (CSRF) | OWASP Foundation We need another package called csurf to generate CSRF token for client. So the client need this token to complete its request. The token is regenerated for each rendered page. 1npm install csurf To use this package: 1234const csrf = require(&#x27;csurf&#x27;);const csrfProtection = csrf();...// middleware for session app.use(csrfProtection); ATTENTION: middleware for csrf have to be after middleware for session. By using csurf, each non-get request will be checked if it has a token. When client get a page, it will get a csrf token through req.csrfToken() For example: 123456789101112131415exports.getIndex = (req, res, next) =&gt; &#123; Product.find() .then(products =&gt; &#123; res.render(&#x27;shop/index&#x27;, &#123; prods: products, pageTitle: &#x27;Shop&#x27;, path: &#x27;/&#x27;, isAuthenticated: req.session.isLoggedIn, csrfToken: req.csrfToken() // assign csrfToken to variable called csrfToken &#125;); &#125;) .catch(err =&gt; &#123; console.log(err); &#125;);&#125;; When client sends non-get request from the same page, it should contain a parameter “_csrf” with value of csrfToken. For example, if we have logout form on the page of index : 1234&lt;form action=&quot;/logout&quot; method=&quot;post&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;_csrf&quot; value=&quot;&lt;%= csrfToken %&gt;&quot;&gt; &lt;button type=&quot;submit&quot;&gt;Logout&lt;/button&gt;&lt;/form&gt; Add user feedback for sent requestsTo send feedback to users for invalid input, we use connect-flash : 1npm install connect-flash Then add it as middleware: 12const flash = require(&#x27;connect-flash&#x27;);app.use(flash()); // this has to be after session middleware Now, we can use this middleware in all of our controllers. For example, in auth.js: 12345678User.findOne(&#123; email: email &#125;) .then(user =&gt; &#123; if (!user) &#123; req.flash(&#x27;error&#x27;, &quot;Invalid email or password&quot;); return res.redirect(&#x27;/login&#x27;); &#125; ... &#125;)... This will assign value “Invalid email or password” with key “error” To fetch this value: 1req.flash(&#x27;error&#x27;)","categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"}],"tags":[{"name":"Node.js","slug":"Node-js","permalink":"https://mengqiu.me/tags/Node-js/"},{"name":"Authentication","slug":"Authentication","permalink":"https://mengqiu.me/tags/Authentication/"},{"name":"Security","slug":"Security","permalink":"https://mengqiu.me/tags/Security/"}]},{"title":"Mongoose with Node.js","slug":"Mongoose-with-Node-js","date":"2022-03-01T16:14:57.000Z","updated":"2022-03-01T16:16:24.218Z","comments":true,"path":"2022/03/01/Mongoose-with-Node-js/","link":"","permalink":"https://mengqiu.me/2022/03/01/Mongoose-with-Node-js/","excerpt":"Mongoose is an Object-Document Mapping library. It’s used like ORM in Sequelize.","text":"Mongoose is an Object-Document Mapping library. It’s used like ORM in Sequelize. Install1npm install mongoose ConnectWe don’t have to configure database.js utility as before. Mongoose will take care for us. 1234567mongoose.connect(&#x27;mongodb+srv://username:password@cluster0.f6tfr.mongodb.net/myFirstDatabase?retryWrites=true&amp;w=majority&#x27;).then(result =&gt; &#123; app.listen(3333);&#125;).catch(err =&gt; &#123; console.log(err);&#125;); Create schemaAlthough mongoDB is schemaless, we still need some restrictions to keep data organized. 1234567891011121314151617181920212223const mongoose = require(&#x27;mongoose&#x27;);const Schema = mongoose.Schema;const productSchema = new Schema(&#123; title: &#123; type: String, required: true &#125;, price: &#123; type: Number, required: true &#125;, description: &#123; type: String, required: true &#125;, imageUrl: &#123; type: String, required: true &#125;&#125;);module.exports = mongoose.model(&#x27;Product&#x27;, productSchema); Create embedded document in a schemaIf we have an embedded document within a schema (e.g., user has a cart with him) 12345678910111213141516const userSchema = new Schema(&#123; name: &#123; type: String, required: true &#125;, email: &#123; type: String, required: true &#125;, cart: &#123; items: [&#123; productId: &#123; type: Schema.Types.ObjectId &#125;, quantity: &#123; type: Number, required: true &#125; &#125;] &#125;&#125;) Save an objectMongoose has embedded method called save() 1234567891011121314const product = new Product(&#123; title: title, price: price, description: description, imageUrl: imageUrl &#125;); product .save() .then(result =&gt; &#123; console.log(&#x27;Created product&#x27;); &#125;) .catch(err =&gt; &#123; console.log(err); &#125;); Get objectUse findById() can get object by id Edit objectWe can fetch an object with findById() first and edit this object. Then use save() to update this object. 12345678Product.findById(prodId) .then(product =&gt; &#123; product.title = updatedTitle; product.price = updatedPrice; product.description = updatedDesc; product.imageUrl = updatedImageUrl; return product.save(); &#125;) Delete objectUse findByIdAndDelete() can get the object and delete it. 12345Product.findByIdAndDelete(prodId) .then(result =&gt; &#123; console.log(&#x27;DESTROYED PRODUCT&#x27;); res.redirect(&#x27;/admin/products&#x27;); &#125;) Create a method for Mongoose entityTo create a method, we need methods keyword: 1userSchema.methods.addToCart = function(product)&#123;...&#125; To access document content of embedded documentIf we want to access embedded document content, for example for object below: 12345678910111213141516const userSchema = new Schema(&#123; name: &#123; type: String, required: true &#125;, email: &#123; type: String, required: true &#125;, cart: &#123; items: [&#123; product: &#123; type: Schema.Types.ObjectId, ref: &#x27;Product&#x27;, required: true &#125;, quantity: &#123; type: Number, required: true &#125; &#125;] &#125;&#125;); If we want to access product details within cart.items , we should use ._doc . 123const products = user.cart.items.map(i =&gt; &#123; return &#123; quantity: i.quantity, product: &#123; ...i.product._doc &#125; &#125;&#125;);","categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"}],"tags":[{"name":"Node.js","slug":"Node-js","permalink":"https://mengqiu.me/tags/Node-js/"},{"name":"MongoDB","slug":"MongoDB","permalink":"https://mengqiu.me/tags/MongoDB/"},{"name":"Mongoose","slug":"Mongoose","permalink":"https://mengqiu.me/tags/Mongoose/"}]},{"title":"MongoDB with Node.js","slug":"MongoDB-with-Node-js","date":"2022-02-27T20:25:13.000Z","updated":"2022-02-27T20:31:31.563Z","comments":true,"path":"2022/02/27/MongoDB-with-Node-js/","link":"","permalink":"https://mengqiu.me/2022/02/27/MongoDB-with-Node-js/","excerpt":"MongoDB is a famous noSQL database which is fast. The data are stored in collections instead of tables inside the database.","text":"MongoDB is a famous noSQL database which is fast. The data are stored in collections instead of tables inside the database. SetupInstall mongoDB in npm first: 1npm install mongodb Create database.js to connect with the database, here is the connection to cloud database: 12345678910111213141516171819202122232425const mongodb = require(&#x27;mongodb&#x27;);const MongoClient = mongodb.MongoClient;let _db;const mongoConnect = (callback) =&gt; &#123; MongoClient.connect(&#x27;mongodb+srv://username:password@cluster0.f6tfr.mongodb.net/myFirstDatabase?retryWrites=true&amp;w=majority&#x27;).then(client =&gt; &#123; console.log(&quot;connected !&quot;); _db = client.db(); callback();&#125;).catch(err =&gt; &#123; console.log(err); throw err;&#125;);&#125;const getDb = () =&gt; &#123; if (_db) &#123; return _db; &#125; throw &#x27;No database found&#x27;;&#125;exports.mongoConnect = mongoConnect;exports.getDb = getDb; The string within connect() comes from the configuration of mongoDB Cloud. Then use following code to connect with database: 1234mongoConnect((client)=&gt; &#123; console.log(client); app.listen(3000);&#125;); Create/update entry in DBLet’s say we have an object called Product. Within the Product class, we need the function save() to insert/update this object into database. We can check if the product has an id, if it has an id, then do updating procedure. MongoDB has its own way to store primary key, we need new mongodb.ObejctId(id) to generate the product id. And here’s the class: 12345678910111213141516171819202122232425const getDb = require(&#x27;../util/database&#x27;).getDb;class Product &#123; constructor(title, price, description, imageUrl, id) &#123; this.title = title; this.price = price; this.description = description; this.imageUrl = imageUrl; this._id = id ? new mongodb.ObjectId(id) : null; // check if the product has an id, if it doesn&#x27;t have one, create a new one &#125; save() &#123; const db = getDb(); let dbOp; if (this._id) &#123; dbOp = db.collection(&#x27;products&#x27;).updateOne( &#123;_id: this._id&#125;, &#123; $set: this &#125; ); &#125; else &#123; dbOp = db.collection(&#x27;products&#x27;).insertOne(this); &#125; return dbOp; &#125;&#125;module.exports = Product; Then, we can create a new Product and save it as below: 1234567const product = new Product(title, price, description, imageUrl); product.save() .then(result =&gt; &#123; console.log(&#x27;Created product&#x27;); res.redirect(&#x27;/admin/products&#x27;); &#125;) .catch(); Get / DeleteTo get all the entries in a table: 1234567891011static fetchAll() &#123; const db = getDb(); return db.collection(&#x27;products&#x27;) .find() .toArray() .then(products =&gt; &#123; console.log(products); return products; &#125;) .catch(); &#125; To get an entry by id, we should use new mongodb.ObejctId(id) to get the id in mongodb here: 1234567891011static findById(prodId) &#123; const db = getDb(); return db.collection(&#x27;products&#x27;) .find(&#123; _id: new mongodb.ObjectId(prodId) &#125;) .next() .then(product =&gt; &#123; console.log(product); return product; &#125;) .catch(err =&gt; console.log(err)); &#125; In the above example: we used find().next() to get a product. find() will get a cursor to a list of products. Using next() moves the cursor to the first entry of this list. We can use findOne(prodId) alternatively to get a product To delete entry by id: 12345678910static deleteById(prodId) &#123; const db = getDb(); return db.collection(&#x27;products&#x27;).deleteOne(&#123; _id: new mongodb.ObjectId(prodId) &#125;) .then(result =&gt; &#123; console.log(&#x27;Deleted&#x27;) &#125;) .catch(err =&gt; &#123; console.log(err); &#125;); &#125; To know more MongoDB query language:https://www.notion.so/rogermchen/MongoDB-with-NodeJS-7393af4873c640ff8dfa8261a64fefc2#ddb94de10b5b4b0d896ddd74fcdc2cce","categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"}],"tags":[{"name":"Node.js","slug":"Node-js","permalink":"https://mengqiu.me/tags/Node-js/"},{"name":"MongoDB","slug":"MongoDB","permalink":"https://mengqiu.me/tags/MongoDB/"}]},{"title":"Mysql with Node.js","slug":"Mysql-with-NodeJS","date":"2022-02-10T14:32:18.000Z","updated":"2022-03-06T02:45:17.610Z","comments":true,"path":"2022/02/10/Mysql-with-NodeJS/","link":"","permalink":"https://mengqiu.me/2022/02/10/Mysql-with-NodeJS/","excerpt":"To connect mysql with NodeJS, we need a package called ‘mysql2’. And setup pool in our database.js. We also need the promise() of the connection pool to use the async feature.","text":"To connect mysql with NodeJS, we need a package called ‘mysql2’. And setup pool in our database.js. We also need the promise() of the connection pool to use the async feature. Setup connection12345678910const mysql = require(&#x27;mysql2&#x27;);const pool = mysql.createPool(&#123; host: &#x27;localhost&#x27;, user: &#x27;root&#x27;, database: &#x27;node&#x27;, password: &#x27;password&#x27;&#125;);module.exports = pool.promise(); Use the database connection:1const db = require(&#x27;./util/database&#x27;); Shutdown database1db.end(); Select query1234567db.execute(&#x27;SELECT * FROM products&#x27;) .then(result =&gt; &#123; console.log(result[0], result[1]); &#125;) .catch(err =&gt; &#123; console.log(err); &#125;); We can also select with condition: 1db.execute(&#x27;SELECT * FROM products WHERE products.id = ?&#x27;, [id]); The result of select statement always an array. Insert query1234db.execute(&#x27;INSERT INTO products (title, price, imageUrl, description) VALUES (?, ?, ?, ?)&#x27;,[this.title, this.price, this.imageUrl, this.description]); Using ? in values creates template for user input so SQL injection can be prevented. ORMWe use Sequelize package to setup connect. In database.js, we still need information of our database but there’s no need to construct tables in MySQL 12345678const Sequelize = require (&#x27;sequelize&#x27;);const sequelize = new Sequelize(&#x27;node&#x27;, &#x27;root&#x27;, &#x27;password&#x27;, &#123; dialect: &#x27;mysql&#x27;, host: &#x27;localhost&#x27;&#125;);module.exports = sequelize; For different objects, we use Sequelize to define the data fields in database: 123456789101112131415161718192021222324252627const Sequelize = require(&#x27;sequelize&#x27;);const sequelize = require(&#x27;../util/database&#x27;);const Product = sequelize.define(&#x27;product&#x27;, &#123; id: &#123; type: Sequelize.INTEGER, autoIncrement: true, allowNull: false, primaryKey: true &#125;, title: Sequelize.STRING, price: &#123; type: Sequelize.DOUBLE, allowNull: false &#125;, imageUrl: &#123; type: Sequelize.STRING, allowNull: false &#125;, description: &#123; type: Sequelize.STRING, allowNull: false &#125;&#125;);module.exports = Product; We also need to sync our ORM with database in app.js 12345678910const sequelize = require(&#x27;./util/database&#x27;);sequelize.sync().then( result =&gt; &#123; //console.log(result); app.listen(3000);&#125;).catch (err =&gt; &#123; console.log(err);&#125;); Sequelize document is here: Sequelize Defining object relationship:Object can have one-to-one, one-to-many, man-to-many relationship, below is an example of defining the relationship: 123Product.belongsTo(User, &#123;constraints: true, onDelete: &#x27;CASCADE&#x27; &#125;);// &#123;constraints...&#125; is optionalUser.hasMany(Product); Fetch entrySequelize has findByPk function to find object by object’s primary key. Or we can use Where clause with findAll , for example: 1234567891011Product.findAll(&#123; where: &#123; id: prodId &#125; &#125;) .then(products =&gt; &#123; res.render(&#x27;shop/product-detail&#x27;, &#123; product: products[0], pageTitle: products[0].title, path: &#x27;/products&#x27; &#125;); &#125;) .catch(err =&gt; &#123; console.log(err); &#125;); Sequelize provides keyword to fetch product of this user: 1234user .getProducts(&#123; where: &#123; id: prodId &#125; &#125;) .then() .catch() Create entry in databaseUsing create will create a new entry in database: 1User.create(&#123; name: &#x27;Max&#x27;, email: &#x27;test@email.com&#x27; &#125;); We can also create a product for this user by using Sequelize keyword: 12345678910user.createProduct(&#123; title: title, price: price, imageUrl: imageUrl, description: description, userId: req.user.id &#125; ).then(...).catch(...); Many-to-many relationshipTo resolve many-to-many relationship, we need a bridging table. For example, one shopping cart can have multiple products and each product can exist in multiple carts. So we need CartItem as a bridging table to connect these two objects. In Sequelize, we can create Cart as below: 1234567891011121314const Sequelize = require(&#x27;sequelize&#x27;);const sequelize = require(&#x27;../util/database&#x27;);const Cart = sequelize.define(&#x27;cart&#x27;, &#123; id: &#123; type: Sequelize.INTEGER, autoIncrement: true, allowNull: false, primaryKey: true &#125;&#125;);module.exports = Cart; And CartItem as below: 123456789101112131415const Sequelize = require(&#x27;sequelize&#x27;);const sequelize = require(&#x27;../util/database&#x27;);const CartItem = sequelize.define(&#x27;cartItem&#x27;, &#123; id: &#123; type: Sequelize.INTEGER, autoIncrement: true, allowNull: false, primaryKey: true &#125;, quantity: Sequelize.INTEGER&#125;);module.exports = CartItem; Then we use belongsToMany to connect Cart and Product: 12Cart.belongsToMany(Product, &#123; through: CartItem &#125;);Product.belongsToMany(Cart, &#123; through: CartItem &#125;);","categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"}],"tags":[{"name":"Node.js","slug":"Node-js","permalink":"https://mengqiu.me/tags/Node-js/"},{"name":"Database","slug":"Database","permalink":"https://mengqiu.me/tags/Database/"},{"name":"Sequelize","slug":"Sequelize","permalink":"https://mengqiu.me/tags/Sequelize/"}]},{"title":"MVC with Node.js","slug":"MVC-with-NodeJS","date":"2022-02-05T22:44:35.000Z","updated":"2022-02-19T17:13:12.559Z","comments":true,"path":"2022/02/05/MVC-with-NodeJS/","link":"","permalink":"https://mengqiu.me/2022/02/05/MVC-with-NodeJS/","excerpt":"MVC, model-view-controller is a very common pattern used in web development. We can build it with ExpressJS. Here’s an example of shop-product-admin site.","text":"MVC, model-view-controller is a very common pattern used in web development. We can build it with ExpressJS. Here’s an example of shop-product-admin site. Entry pointWe usually use app.js as entry point. This entry point loads various middleware and routes request to these middleware. 123456789101112131415161718192021const path = require(&#x27;path&#x27;);const express = require(&#x27;express&#x27;);const bodyParser = require(&#x27;body-parser&#x27;);const app = express();const errorController = require(&#x27;./controllers/error&#x27;);app.set(&#x27;view engine&#x27;, &#x27;ejs&#x27;);app.set(&#x27;views&#x27;, &#x27;views&#x27;);const adminRoutes = require(&#x27;./routes/admin&#x27;);const shopRoutes = require(&#x27;./routes/shop&#x27;);app.use(bodyParser.urlencoded(&#123;extended: false&#125;));app.use(express.static(path.join(__dirname, &#x27;public&#x27;)));app.use(&#x27;/admin&#x27;, adminRoutes.routes);app.use(shopRoutes);app.use(errorController.pageNotFound);app.listen(3000); app.use(express.static(path.join(__dirname, &#39;public&#39;))); loads public folder as a static resource. Modelproduct.js is responsible for fetching all the products from file and saving products to file. 1234567891011121314151617181920212223242526272829303132333435363738const fs = require(&#x27;fs&#x27;);const path = require(&#x27;path&#x27;);const p = path.join( path.dirname(require.main.filename), &#x27;data&#x27;, &#x27;products.json&#x27;);const getProductsFromFile = cb =&gt; &#123; fs.readFile(p, (err, fileContent) =&gt; &#123; if(err) &#123; return cb([]); &#125; else &#123; cb(JSON.parse(fileContent)); &#125; &#125;);&#125;;module.exports = class Product &#123; constructor(title) &#123; this.title = title; &#125; save() &#123; getProductsFromFile(products =&gt; &#123; products.push(this); fs.writeFile(p, JSON.stringify(products), err =&gt; &#123; console.log(err); &#125;) &#125;); &#125; static fetchAll(cb) &#123; getProductsFromFile(cb); &#125;&#125; cart.js is responsible for fetching shop cart data from a file. 1234567891011121314151617181920212223242526272829const fs = require(&#x27;fs&#x27;);const path = require(&#x27;path&#x27;);const p = path.join( path.dirname(require.main.filename), &#x27;data&#x27;, &#x27;cart.json&#x27;);const getCartFromFile = cb =&gt; &#123; fs.readFile(p, (err, content) =&gt; &#123; if(err) &#123; return cb([]); &#125; else &#123; cb (JSON.parse(content)); &#125; &#125;);&#125;module.exports = class Cart &#123; constructor(title) &#123; this.title = title; &#125; static fetchAll(cb) &#123; getCartFromFile(cb); &#125;&#125; Controllersadmin.js is to define the paths of different methods/operations for administrator and render the view for the paths. 1234567891011121314151617181920212223242526const Product = require(&#x27;../models/product&#x27;);exports.getAddProduct = (req, res, next) =&gt; &#123; res.render(&#x27;admin/products&#x27;, &#123; docTitle: &#x27;Add Product&#x27;, path: &#x27;/admin/add-product&#x27;, activeAddProduct: true, formsCSS: true &#125;)&#125;exports.postAddProduct = (req, res, next) =&gt; &#123; const product = new Product(req.body.title); product.save(); res.redirect(&#x27;/&#x27;);&#125;exports.getProducts = (req, res, next) =&gt; &#123; Product.fetchAll(products =&gt; &#123; res.render(&#x27;admin/products&#x27;, &#123; prods: products, docTitle: &#x27;Admin Products&#x27;, path: &#x27;/admin/products&#x27; &#125;); &#125;)&#125; shop.js is to define the paths of different methods/operations on products. It also defines which pages are rendered for these paths. 1234567891011121314151617181920212223242526272829303132333435363738394041const Product = require(&#x27;../models/product&#x27;);exports.getProducts = (req, res, next) =&gt; &#123; Product.fetchAll((products) =&gt; &#123; res.render(&#x27;shop/product-list&#x27;, &#123; prods: products, docTitle: &#x27;Shop&#x27;, path: &#x27;/&#x27;, hasProducts: products.length &gt; 0, activeShop: true, productCSS: true &#125;); &#125;); &#125;exports.getIndex = (req, res, next) =&gt; &#123; Product.fetchAll((products) =&gt; &#123; res.render(&#x27;shop/index&#x27;, &#123; prods: products, docTitle: &#x27;Shop&#x27;, path: &#x27;/&#x27;, hasProducts: products.length &gt; 0, activeShop: true, productCSS: true &#125;); &#125;);&#125;exports.getCart = (req, res, next) =&gt; &#123; res.render(&#x27;shop/cart&#x27;, &#123; path: &#x27;/car&#x27;, docTitle: &#x27;Your cart&#x27; &#125;);&#125;;exports.getCheckout = (req, res, next) =&gt; &#123; res.render(&#x27;shop/checkout&#x27;, &#123; path: &#x27;/checkout&#x27;, docTitle: &#x27;Checkout&#x27; &#125;);&#125;; error.js controls the path to 404 Page not found error 123456exports.pageNotFound = (req, res, next) =&gt; &#123; res.render(&#x27;404&#x27;, &#123; docTitle: &#x27;404&#x27;, path: &#x27;/404&#x27; &#125;);&#125; RoutesRoutes are responsible for routing requests to different paths admin.js will lead GET/POST request to paths as below: 123456789101112const path = require(&#x27;path&#x27;);const express = require(&#x27;express&#x27;);const adminController = require(&#x27;../controllers/admin&#x27;);const router = express.Router();router.get(&#x27;/add-product&#x27;, adminController.getAddProduct);router.get(&#x27;/products&#x27;); // need controller, but unimplementedrouter.post(&#x27;/add-product&#x27;, adminController.postAddProduct);exports.routes = router; Remember, we have defined the filter for middleware adminRoutes at the very beginning: 1app.use(&#x27;/admin&#x27;, adminRoutes.routes); So all the path in admin.js router is under /admin path. shop.js will lead GET request to paths as below: 1234567891011121314151617const path = require(&#x27;path&#x27;);const express = require(&#x27;express&#x27;);const shopController = require(&#x27;../controllers/shop&#x27;);const router = express.Router();router.get(&#x27;/&#x27;, shopController.getIndex);router.get(&#x27;/products&#x27;, shopController.getProducts);router.get(&#x27;/cart&#x27;, shopController.getCart);router.get(&#x27;/checkout&#x27;, shopController.getCheckout);module.exports = router; ViewsThese are defined in app.js: 12app.set(&#x27;view engine&#x27;, &#x27;ejs&#x27;);app.set(&#x27;views&#x27;, &#x27;views&#x27;); These two lines means the view engine is EJS and views folder is called views in the root directory of this project. View engine doesn’t have to be EJS. You can use pure html if you want.","categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"}],"tags":[{"name":"Node.js","slug":"Node-js","permalink":"https://mengqiu.me/tags/Node-js/"},{"name":"Routing","slug":"Routing","permalink":"https://mengqiu.me/tags/Routing/"},{"name":"MVC","slug":"MVC","permalink":"https://mengqiu.me/tags/MVC/"}]},{"title":"Call API from Facebook","slug":"Call-API-from-Facebook","date":"2022-01-31T16:37:46.000Z","updated":"2022-01-31T16:38:28.777Z","comments":true,"path":"2022/01/31/Call-API-from-Facebook/","link":"","permalink":"https://mengqiu.me/2022/01/31/Call-API-from-Facebook/","excerpt":"Simple walkthrough Facebook OAuth login and call API","text":"Simple walkthrough Facebook OAuth login and call API SetupCreate an app: Skipped. Go to Facebook developer Besides, take note for app id and app secret Call authorization end pointAdd a OAuth redirect URI. The URI should be encoded. Check: https://www.urlencoder.org/ Use your browser visit: 1https://www.facebook.com/v12.0/dialog/oauth?client_id=&#123;app-id&#125;&amp;redirect_uri=&#123;redirect-uri&#125;&amp;state=1 Replace app-id and redirect-uri The browser will be redirected to the url set by you with a code: 1http://localhost:8080/?code=AQDf_x7kmu_Kq2GXPQ8ZH5xy5brC2V_n0TqNngEj8gNHlAY4qyph1aOGxpZIfiwasueJOHZ0P-FkdZGV5qHZCL1ILM58G1l9CYlJVltasRWSwC7vAH5aWp6tNPT8eFZfifzf8SSv6fp2G1dNfJHBkh6FUDCjro1hOFUz_I7zyFfK7TKQNUccle8Q_YrC9uASjoNMOEgJb4Rs4QHaEuUO3lI7kqJXjZqvBGnIKWOZoFqdIt4Q0DFNtgd8KEbQtoNLbq4FJbZAIBk99pMb6U-qeQ0RcF5tX0RgvUJAlISD7GhqRjwFfGKMiyaVQGZOFSpvHLCEOdOsYy3KggLl00Bk-YSXayKegZ4OYE9tR1vlkyN9W_C-LMmhgEMpwNOz-GEoscZ1C4m89znp3bzY0YcQCv4wiyF47Xz3E8ItsU1_tDglJd2wkZBvIWXquHuvbSIIZKY&amp;state=1#_=_ Token endpointIt’s GET instead of POST 1https://graph.facebook.com/v12.0/oauth/access_token?redirect_uri=&#123;encoded-uri&#125;&amp;client_id=&#123;app-id&#125;&amp;client_secret=&#123;app-secret&#125;&amp;code=&#123;code&#125; replace encoded-uri, app-id, app-secret, code. It will return with access_token: 12345&#123; &quot;access_token&quot;: &quot;EAAI2o6ZAfRqgBANx3A6oymSKAz7rmuZCZAtEHudr1hvASwrInuvxitrAZC9QHqzkeiLLnynqvou1FmOabIaaMeamoOLfSTebsPKtTTKJEkW1SML1cjFKECth4bvMZAKMcsfhlUyCQ5TIj76ZBZBfbHNBeLTFTBfeZAxb8ZCO8n9zv1Kcg6EXpmeVq8SUnunStIhaTGIX4bZBQri4DHSbN5bcLnhqdCjyDIFJgBQGke7HjMNyyoZBgUlhs5HYq64Rg8h58MZD&quot;, &quot;token_type&quot;: &quot;bearer&quot;, &quot;expires_in&quot;: 5182590&#125; Call API1curl -H &quot;Accept: application/json&quot; -H &quot;Authorization: Bearer EAAI2o6ZAfRqgBANx3A6oymSKAz7rmuZCZAtEHudr1hvASwrInuvxitrAZC9QHqzkeiLLnynqvou1FmOabIaaMeamoOLfSTebsPKtTTKJEkW1SML1cjFKECth4bvMZAKMcsfhlUyCQ5TIj76ZBZBfbHNBeLTFTBfeZAxb8ZCO8n9zv1Kcg6EXpmeVq8SUnunStIhaTGIX4bZBQri4DHSbN5bcLnhqdCjyDIFJgBQGke7HjMNyyoZBgUlhs5HYq64Rg8h58MZD&quot; &quot;https://graph.facebook.com/me&quot; This api call will return name and user id.","categories":[{"name":"API","slug":"API","permalink":"https://mengqiu.me/categories/API/"}],"tags":[{"name":"API","slug":"API","permalink":"https://mengqiu.me/tags/API/"},{"name":"OAuth","slug":"OAuth","permalink":"https://mengqiu.me/tags/OAuth/"}]},{"title":"OAuth2 (Facebook) setup","slug":"OAuth2-Facebook-setup","date":"2022-01-31T15:13:42.000Z","updated":"2022-01-31T15:17:51.704Z","comments":true,"path":"2022/01/31/OAuth2-Facebook-setup/","link":"","permalink":"https://mengqiu.me/2022/01/31/OAuth2-Facebook-setup/","excerpt":"OAuth is commonly used now. This post is for Facebook OAuth login. All we need is Facebook App ID, App secret. And OAuth2User, DefaultOAuth2UserService, UserDetails, UserDetailsService. In addition, we need Spring security, oauth2-client dependencies. I will use MyBatis for this tiny project.","text":"OAuth is commonly used now. This post is for Facebook OAuth login. All we need is Facebook App ID, App secret. And OAuth2User, DefaultOAuth2UserService, UserDetails, UserDetailsService. In addition, we need Spring security, oauth2-client dependencies. I will use MyBatis for this tiny project. Facebook and application configureFirst thing to do is to setup your app with your Facebook developer account. This procedure is omitted here. Once you finished, take a note for your App Id (client Id), App Secret (client secret). Besides, you need to get advanced granted permission for public profile and email. These two permission can be fetched without app review. Here’s the Yaml file of project, the security part is the one needs attention: 12345678910111213141516171819202122debug: truespring: datasource: url: jdbc:mysql://localhost:3306/chat username: root password: password initialization-mode: always servlet: multipart: max-file-size: 10MB max-request-size: 10MB enabled: true tomcat: max-swallow-size: -1 security: oauth2: client: registration: facebook: clientId: your client Id clientSecret: your client secret File structureHere’s the file structure: 123456789101112131415security- CustomOAuth2User- CustomOAuth2UserService- MyUserDetails- UserDetailsServiceImp- WebSecurityConfigController- LoginController- HomeControllerModel- UserMapper- UserMapperService- UserService DependenciesAnd Here are needed dependencies: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.2.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt; &lt;artifactId&gt;thymeleaf-extras-springsecurity5&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.security&lt;/groupId&gt; &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-oauth2-client&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; ClassesUserI separated user and role into two tables. You can put them together 1234567891011public class User implements Serializable &#123; private long userId; private String email; // This can be used as username private String phone; // optional private String password; private LocalDate startDate; // optional private LocalDateTime loginTime; // optional private int roleId; // Link to role table, you can use barely String here private boolean isActive; // optional private boolean isSuspended; // optional&#125; Role (optional, or using String inside User)1234public class Role &#123; private short roleId; private String roleName;&#125; UserMapper1234567891011121314151617181920212223242526272829303132333435363738394041424344@Mapperpublic interface UserMapper &#123; /* Create */ @Insert(&quot;INSERT INTO user (email, password, startDate, loginTime, roleId, isActive, isSuspended) VALUES &quot; + &quot;(#&#123;email&#125;, #&#123;password&#125;, #&#123;startDate&#125;, #&#123;loginTime&#125;, #&#123;roleId&#125;, #&#123;isActive&#125;, #&#123;isSuspended&#125;)&quot;) @Options(useGeneratedKeys = true, keyProperty = &quot;userId&quot;) int save(User user); /* Read */ @Select(&quot;SELECT * FROM user WHERE email = #&#123;email&#125;&quot;) @Results (&#123; @Result(id = true, property = &quot;userId&quot;, column = &quot;userId&quot;), @Result(property = &quot;email&quot;, column = &quot;email&quot;), @Result(property = &quot;phone&quot;, column = &quot;phone&quot;), @Result(property = &quot;password&quot;, column = &quot;password&quot;), @Result(property = &quot;startDate&quot;, column = &quot;startDate&quot;), @Result(property = &quot;loginTime&quot;, column = &quot;loginTime&quot;), @Result(property = &quot;roleId&quot;, column = &quot;roleId&quot;), @Result(property = &quot;isActive&quot;, column = &quot;isActive&quot;), @Result(property = &quot;isSuspended&quot;, column = &quot;isSuspended&quot;) &#125;) User findByEmail(String email); @Select(&quot;SELECT * FROM user WHERE userId = #&#123;userId&#125;&quot;) @Results (&#123; @Result(id = true, property = &quot;userId&quot;, column = &quot;userId&quot;), @Result(property = &quot;email&quot;, column = &quot;email&quot;), @Result(property = &quot;phone&quot;, column = &quot;phone&quot;), @Result(property = &quot;password&quot;, column = &quot;password&quot;), @Result(property = &quot;startDate&quot;, column = &quot;startDate&quot;), @Result(property = &quot;loginTime&quot;, column = &quot;loginTime&quot;), @Result(property = &quot;roleId&quot;, column = &quot;roleId&quot;), @Result(property = &quot;isActive&quot;, column = &quot;isActive&quot;), @Result(property = &quot;isSuspended&quot;, column = &quot;isSuspended&quot;) &#125;) User findById(long userId); @Select(&quot;SELECT * FROM role WHERE roleId = #&#123;roleId&#125;&quot;) Role getRoleOfUser(User user);&#125; UserService123456789101112131415161718192021@Servicepublic class UserService &#123; @Autowired private UserMapper userMapper; public void processOAuthPostLogin(String email) &#123; User existedUser = userMapper.findByEmail(email); if(existedUser == null) &#123; User newUser = new User(); newUser.setEmail(email); newUser.setPassword(&quot;password&quot;); // Should use encryption here, but we stay simple newUser.setStartDate(LocalDate.now()); // optional newUser.setLoginTime(LocalDateTime.now()); // optional newUser.setRoleId(2); newUser.setActive(true); // optional newUser.setSuspended(false); // optional userMapper.save(newUser); &#125; &#125;&#125; CustomOAuth2User123456789101112131415161718192021222324252627public class CustomOAuth2User implements OAuth2User &#123; private final OAuth2User oAuth2User; public CustomOAuth2User(OAuth2User oAuth2User) &#123; this.oAuth2User = oAuth2User; &#125; @Override public Map&lt;String, Object&gt; getAttributes() &#123; return oAuth2User.getAttributes(); &#125; @Override public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123; return oAuth2User.getAuthorities(); &#125; @Override public String getName() &#123; return oAuth2User.getAttribute(&quot;name&quot;); &#125; public String getEmail() &#123; return oAuth2User.getAttribute(&quot;email&quot;); &#125;&#125; CustomOAuth2UserService123456789@Servicepublic class CustomOAuth2UserService extends DefaultOAuth2UserService &#123; @Override public OAuth2User loadUser(OAuth2UserRequest userRequest) throws OAuth2AuthenticationException &#123; OAuth2User user = super.loadUser(userRequest); return new CustomOAuth2User(user); &#125;&#125; MyUserDetails12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public class MyUserDetails implements UserDetails &#123; private final User user; private Collection&lt;GrantedAuthority&gt; authorities; public MyUserDetails(User user) &#123; this.user = user; &#125; public void setAuthorities (List&lt;? extends GrantedAuthority&gt; authorities) &#123; this.authorities = (Collection&lt;GrantedAuthority&gt;) authorities; &#125; @Override public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123; return this.authorities; &#125; @Override public String getPassword() &#123; return user.getPassword(); &#125; @Override public String getUsername() &#123; return user.getEmail(); &#125; @Override public boolean isAccountNonExpired() &#123; return true; &#125; @Override public boolean isAccountNonLocked() &#123; return !user.isSuspended(); // optional, should return true by default &#125; @Override public boolean isCredentialsNonExpired() &#123; return true; &#125; @Override public boolean isEnabled() &#123; return user.isActive(); // optional, should return true by default &#125;&#125; UserDetailsServiceImp1234567891011121314151617181920212223public class UserDetailsServiceImp implements UserDetailsService &#123; @Autowired private UserMapper userMapper; @Override public UserDetails loadUserByUsername(String email) throws UsernameNotFoundException &#123; User user = userMapper.findByEmail(email); if(user == null) &#123; throw new UsernameNotFoundException(&quot;Couldn&#x27;t find user&quot;); &#125; Role role = userMapper.getRoleOfUser(user); List&lt;SimpleGrantedAuthority&gt; authorities = new ArrayList&lt;&gt;(); authorities.add(new SimpleGrantedAuthority(role.getRoleName())); MyUserDetails userDetails = new MyUserDetails(user); userDetails.setAuthorities(authorities); return userDetails; &#125;&#125; WebSecurityConfig1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556@EnableWebSecurity@Configurationpublic class WebSecurityConfig extends WebSecurityConfigurerAdapter &#123; @Autowired private CustomOAuth2UserService oauth2UserService; @Autowired private UserService userService; @Bean public UserDetailsService userDetailsService() &#123; return new UserDetailsServiceImp(); &#125; @Bean public BCryptPasswordEncoder passwordEncoder() &#123; return new BCryptPasswordEncoder(); &#125; @Bean public DaoAuthenticationProvider authenticationProvider() &#123; DaoAuthenticationProvider authenticationProvider = new DaoAuthenticationProvider(); authenticationProvider.setUserDetailsService(userDetailsService()); authenticationProvider.setPasswordEncoder(passwordEncoder()); return authenticationProvider; &#125; @Override protected void configure (AuthenticationManagerBuilder auth) &#123; auth.authenticationProvider(authenticationProvider()); &#125; @Override protected void configure(HttpSecurity http) throws Exception&#123; http.authorizeRequests() .antMatchers(&quot;/login&quot;).permitAll() .anyRequest().authenticated() .and() .oauth2Login() .loginPage(&quot;/login&quot;) .userInfoEndpoint() .userService(oauth2UserService) .and() .successHandler((request, response, authentication) -&gt; &#123; CustomOAuth2User oAuth2User = (CustomOAuth2User) authentication.getPrincipal(); userService.processOAuthPostLogin(oAuth2User.getEmail()); response.sendRedirect(&quot;/home&quot;); &#125;) .and() .exceptionHandling().accessDeniedPage(&quot;/403&quot;); http.logout(); &#125;&#125; Front endNow you can call get /login in webpage. The procedure is omitted. To logout, use post /logout. PS: how to use Facebook OAuth and APIhttps://api-university.com/blog/api-usage/how-to-use-the-facebook-api-and-oauth/","categories":[{"name":"Java","slug":"Java","permalink":"https://mengqiu.me/categories/Java/"}],"tags":[{"name":"Security","slug":"Security","permalink":"https://mengqiu.me/tags/Security/"},{"name":"OAuth","slug":"OAuth","permalink":"https://mengqiu.me/tags/OAuth/"},{"name":"Spring boot","slug":"Spring-boot","permalink":"https://mengqiu.me/tags/Spring-boot/"}]},{"title":"Serve static content","slug":"Serve-static-content","date":"2022-01-29T23:42:37.000Z","updated":"2022-02-19T17:12:21.205Z","comments":true,"path":"2022/01/29/Serve-static-content/","link":"","permalink":"https://mengqiu.me/2022/01/29/Serve-static-content/","excerpt":"Usually we put all the public content into public folder, including css, images etc. We should tell NodeJS to find the static folder.","text":"Usually we put all the public content into public folder, including css, images etc. We should tell NodeJS to find the static folder. Get root path of our project folderWe need a module called path 12const path = require(&#x27;path&#x27;);module.exports = path.dirname(require.main.filename); Then we can use this module for our root directory. Get static resourcesFor example, if we have file structure like this: shop.html that contains a link to css file &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/main.css&quot;&gt; and the css file is in public folder, we can’t access the css file by simply put public in front of the link like /public/css/main.css . We should use express.static to tell NodeJS which folder is the static resource folder, then when the server sends file, it knows where to fetch the content. In app.js, we need: 1app.use(express.static(path.join(__dirname, &#x27;public&#x27;))); When we call a module: 1app.use(shopRoutes); And the module sends a html page: 123router.get(&#x27;/&#x27;, (req, res, next) =&gt; &#123; res.sendFile(path.join(rootDir, &#x27;views&#x27;, &#x27;shop.html&#x27;));&#125;); This html page then can use the content of static folder 1&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/main.css&quot;&gt;","categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"}],"tags":[{"name":"Node.js","slug":"Node-js","permalink":"https://mengqiu.me/tags/Node-js/"},{"name":"Server","slug":"Server","permalink":"https://mengqiu.me/tags/Server/"}]},{"title":"Project: IPv4 auto subnetting API","slug":"Project-IPv4-auto-subnetting-API","date":"2022-01-28T17:18:04.000Z","updated":"2022-02-01T04:32:18.986Z","comments":true,"path":"2022/01/28/Project-IPv4-auto-subnetting-API/","link":"","permalink":"https://mengqiu.me/2022/01/28/Project-IPv4-auto-subnetting-API/","excerpt":"This is a review of my IPv4 knowledge that learnt two years ago. And This project will replace the old java command line program.You should be able to see the source code here: https://github.com/roger-mengqiu-chen/ipv4subnetting. You can try this web app here: https://ipv4-subnetting.herokuapp.com/","text":"This is a review of my IPv4 knowledge that learnt two years ago. And This project will replace the old java command line program.You should be able to see the source code here: https://github.com/roger-mengqiu-chen/ipv4subnetting. You can try this web app here: https://ipv4-subnetting.herokuapp.com/ Using this APIThe API will handle IPv4 subnetting automatically. It also handles the invalid user input. If the amount of required subnet address is too large, API will return &#39;Not enough address !&#39;. To send request to this API, you need follow the format as below: 12345678&#123; &quot;hostIp&quot;:&quot;210.100.56.0&quot;, &quot;mask&quot;:&quot;255.255.255.0&quot;, &quot;subnets&quot;:&#123; &quot;net1&quot;:2133, &quot;net2&quot;:4 &#125;&#125; Within “subnets”, you need to mention the name of your subnet and the required amount of hosts within this subnet.If the parent network has enough address, it will repond with JSON with following format: 1234567891011121314151617181920212223242526272829303132333435363738[ &#123; &quot;name&quot;: &quot;net2&quot;, &quot;ipAddress&quot;: [ 210, 100, 56, 32 ], &quot;numberOfHosts&quot;: 4, &quot;prefix&quot;: 29, &quot;mask&quot;: [ 255, 255, 255, 248 ], &quot;allocatedAddresses&quot;: 8 &#125;, &#123; &quot;name&quot;: &quot;net1&quot;, &quot;ipAddress&quot;: [ 210, 100, 56, 0 ], &quot;numberOfHosts&quot;: 21, &quot;prefix&quot;: 27, &quot;mask&quot;: [ 255, 255, 255, 224 ], &quot;allocatedAddresses&quot;: 32 &#125;] TheoryIPv4 networkIPv4 is 32 bit long IP address. We can divide the address into 4 sections, each of which is 8 bit long. In human-readable format, we separate these sections with “.” (e.g., 192.168.1.1).All of the IPv4 address can be converted to binary format: For example, 192.168.1.1 can be written in 11000000.10101000.00000001.00000001 Decimal Binary 192 1100 0000 168 1010 0000 1 0000 0001 Prefix and subnet maskPrefix is the number of “1”s in IPv4 binary format address from left to right. It is used to describe which part is the network address (The part with all “1”s is the network portion). For example, 192.168.1.1 /24Prefix /24 can be written in binary format:11111111 11111111 11111111 00000000The first 24 bits are all “1”s.To convert it to human-readable format, we use subnet mask:255.255.255.0 DecimalBinary 25511111111 Determine the networkIPv4 address has two portions: network portion and host portion. To determine the network portion, use logical AND for each bit: For example: 192.168.1.1 /24 Field Value IPv4 host 11000000 10101000 00000001 00000001 Subnet Mask 11111111 11111111 11111111 00000000 Logical AND 11000000 10101000 00000001 00000000 The logical AND result is network address: 192.168.1.0 And the host portion is last \".1\". (i.e., the last 8 bits of IPv4 binary address) Assign the number of IP addresses according to the number of hostsEach network has 2 reserved addresses: broadcast address and network address. Broadcast address is the address with all “1”s in host portion (e.g., 192.168.1.0 /24 broadcast address is 192.168.1.255). Network address is the address with all “0”s in host portion (e.g., 192.168.1.128 /25 network address is 192.168.1.128) Each bit of the network address can hold 2 host addresses (0 and 1). When we allocate IP address for hosts, we caculate the required bits from right to left. For example, if we want to take 6 addresses from 192.168.1.0 /24 network: Convert IP address to binary form: 11000000 10101000 00000001 00000000 6 ≈ 2^3, so 3 bits will be used The rightmost 3 bits are the host part. The rest is network part The prefix is 32 - 3 = 29. The mask is 11111111 11111111 11111111 11111000, which is 255.255.255.248 When we allocate addresses to hosts, remember to add broadcast and network address to the required number of hosts (i.e., 4 required hosts need at least 6 addresses). Divide the parent network according to the required number of host addressesMy strategy is sorting the subnets according to their size. Then allocate addresses from the biggest one. For example, network address is 192.168.1.0 /24 and the table below is the required hosts for each network network namehosts network12 network220 network36 Then we can allocate addresses as below: network name allocated addresses prefix network23227 network3829 network1430 Finally, allocate network addresses from the biggest one network name network address network2192.168.1.0 network3192.168.1.32 network1192.168.1.40","categories":[{"name":"Project","slug":"Project","permalink":"https://mengqiu.me/categories/Project/"}],"tags":[{"name":"API","slug":"API","permalink":"https://mengqiu.me/tags/API/"},{"name":"IPv4","slug":"IPv4","permalink":"https://mengqiu.me/tags/IPv4/"},{"name":"REST","slug":"REST","permalink":"https://mengqiu.me/tags/REST/"}]},{"title":"Express basic routing","slug":"Express-basic-routing","date":"2022-01-27T03:15:27.000Z","updated":"2022-02-20T18:50:50.311Z","comments":true,"path":"2022/01/26/Express-basic-routing/","link":"","permalink":"https://mengqiu.me/2022/01/26/Express-basic-routing/","excerpt":"Express is a minimal and flexible Node.js web application framework that provides a robust set of features for web and mobile applications. In express, everything is middleware.","text":"Express is a minimal and flexible Node.js web application framework that provides a robust set of features for web and mobile applications. In express, everything is middleware. Express 4.x API Install express:1npm install --save express Basic request/response handlingLet’s create a simple routing here: 1234567891011121314151617const http = require(&#x27;http&#x27;);const express = require(&#x27;express&#x27;); // check the source code, it exports a functionconst app = express();app.use((req, res, next) =&gt; &#123; // use add a middleware to the stack console.log(&#x27;in the middleware&#x27;); next(); // allows the request to continue to the next middleware&#125;);app.use((req, res, next) =&gt; &#123; console.log(&#x27;in another middleware&#x27;); res.send(&#x27;&lt;h1&gt;hello from express&lt;/h1&gt;&#x27;);&#125;)app.listen(3000); After running the code above, got to “localhost:3000”, we will get “hello from express” in the browser and two messages in console. We can add some specific path for handling. For example: 1app.use(&#x27;/path&#x27;, (req, res, next) =&gt; &#123;...&#125;); The default path is /, if we don’t specify any path here NodeJS parse from top to bottom, if one function doesn’t have next() in its body, it will block the code and request won’t go to the next function. For example: 123456789app.use (&#x27;/&#x27;, (req, res, next) =&gt; &#123; console.log(&#x27;always run&#x27;); next();&#125;);app.use(&#x27;/add-product&#x27;, (req, res, next) =&gt; &#123; console.log(&#x27;in another middleware&#x27;); res.send(&#x27;&lt;h1&gt;Add product&lt;/h1&gt;&#x27;);&#125;) When we send request ‘/add-product’, The first app.use() has next(), so the second one will be reached and send response back. If the first one doesn’t have next() , the second one won’t be executed, the page will keep loading because there’s no response sent back. To parse request body, we need package called body-parser 1npm install --save body-parser And use bodyParser before all the middlewares 1app.use(bodyParser.urlencoded(&#123;extended: false&#125;)); app.use will handle all types of requests. To handle POST request particularly, just change use to post. 1app.post(&#x27;/path&#x27;, (req, res, next) =&gt; &#123;...&#125;); To handle other http requests, we just need to change it to put, get, etc. Express routingWe can construct some modules to improve reusability: For example, we can make an admin module to handle get request /add-product to get form data for adding product and post request /product to post form data: 12345678910111213const express = require(&#x27;express&#x27;);const router = express.Router();// below will get a form router.get(&#x27;/add-product&#x27;, (req, res, next) =&gt; &#123; res.send(&#x27;&lt;form action=&quot;/product&quot; method=&quot;POST&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;title&quot;&gt;&lt;button type=&quot;submit&quot;&gt;Add product&lt;/button&gt;&lt;/form&gt;&#x27;);&#125;); // below will post the form datarouter.post(&#x27;/product&#x27;, (req, res, next) =&gt; &#123; console.log(req.body); res.redirect(&#x27;/&#x27;); // once print out the body of request, redirect to /&#125;);module.exports = router; Then we can use this module in our entry point (app.js for this example): 1234567const express = require(&#x27;express&#x27;);const bodyParser = require(&#x27;body-parser&#x27;);const adminRoutes = require(&#x27;./admin&#x27;);const app = express();app.use(bodyParser.urlencoded(&#123;extended: false&#125;));app.use(adminRoutes);app.listen(3000); // this will create server and listen on 3000 Difference between app.use() and router.get()1234567const express = require(&#x27;express&#x27;);const app = express();const router = express.Router();app.use(&#x27;/first&#x27;, router); // mount the router as middleware at path /firstrouter.get(&#x27;/sud&#x27;, smaller);router.get(&#x27;/user&#x27;, bigger); When sending /first/sud smaller function will be called. If you open /first/user, then the bigger function will get called. app mounts middleware first, router set subpath accordingly 123app.use(&#x27;/first&#x27;, fun);app.get(&#x27;/sud&#x27;, bigger);app.get(&#x27;/user&#x27;, smaller); In the code above, functions will be called at /first, /sud, /user. If we call /first/sud, there’s no response. Filtering pathsIf request type is different, it can have the same path. For example 12router.get(&#x27;/add-product&#x27;...)router.post(&#x27;/add-product&#x27;...) app.use can have filtering path 1app.use(&#x27;/admin&#x27;, adminRouters) If we have route.get(’/add-product’ ...) within adminRouters, we need send request ‘/admin/add-product’ to get result.","categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"}],"tags":[{"name":"Node.js","slug":"Node-js","permalink":"https://mengqiu.me/tags/Node-js/"},{"name":"Server","slug":"Server","permalink":"https://mengqiu.me/tags/Server/"},{"name":"Routing","slug":"Routing","permalink":"https://mengqiu.me/tags/Routing/"}]},{"title":"Creating a server with Node.js","slug":"Creating-a-server-with-NodeJS","date":"2022-01-26T02:21:29.000Z","updated":"2022-02-19T17:13:41.982Z","comments":true,"path":"2022/01/25/Creating-a-server-with-NodeJS/","link":"","permalink":"https://mengqiu.me/2022/01/25/Creating-a-server-with-NodeJS/","excerpt":"To create a server, we need http module. The application also should keep running with listening to a port. We also need write some code to deal with received request and sending response.","text":"To create a server, we need http module. The application also should keep running with listening to a port. We also need write some code to deal with received request and sending response. CreatingExample: 12345678910111213141516const http = require(&#x27;http&#x27;);function rqListener(req, res) &#123; // using req, res is common practice console.log(req.url, req.method, req.headers); // process.exit(); // close down the server once print the result res.setHeader(&#x27;Content-Type&#x27;, &#x27;text/html&#x27;); // attach a header to response, telling the type is html res.write(&#x27;&lt;html&gt;&#x27;); res.write(&#x27;&lt;head&gt;&lt;title&gt;Test&lt;/title&gt;&lt;/head&gt;&#x27;); res.write(&#x27;&lt;body&gt;&lt;h1&gt;hello&lt;/h1&gt;&lt;/body&gt;&#x27;); res.write(&#x27;&lt;/html&gt;&#x27;); res.end(); // This is the end; content after this point won&#x27;t be sent&#125;const server = http.createServer(rqListener); // have to pass a callback function when create a serverserver.listen(3000); // this will keep running These codes will send a page with title as “Test” and content-type is “text/html” RoutingWe can add some if statements to handle the request and send response accordingly. Example: 12345678910const url = req.url; const method = req.method; if (url === &#x27;/&#x27;) &#123; res.setHeader(&#x27;Content-Type&#x27;, &#x27;text/html&#x27;); // attach a header to response, telling the type is html res.write(&#x27;&lt;html&gt;&#x27;); res.write(&#x27;&lt;head&gt;&lt;title&gt;Enter message&lt;/title&gt;&lt;/head&gt;&#x27;); res.write(&#x27;&lt;body&gt;&lt;form action=&quot;/message&quot; method=&quot;POST&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;message&quot;&gt;&lt;button type=&quot;submit&quot;&gt;Send&lt;/button&gt;&lt;/form&gt;&lt;/body&gt;&#x27;); res.write(&#x27;&lt;/html&gt;&#x27;); return res.end(); // This is the end; content after this point won&#x27;t be sent &#125; These code will send back a form with input box to user when user sends request 123456if (url === &#x27;/message&#x27; &amp;&amp; method === &#x27;POST&#x27;) &#123; fs.writeFileSync(&#x27;message.txt&#x27;, &#x27;dummy&#x27;); res.statusCode = 302; res.setHeader(&#x27;Location&#x27;, &#x27;/&#x27;); return res.end();&#125; The code above will see if user send ‘/message’ POST request. If so, create a file called ‘message.txt’ and save ‘dummy’ into that file. Then return code 302 and redirect page to ‘ localhost:port/ ’. Parsing request dataWe can set event listener on request with on. For example: 1234567891011121314const body = [];// listen on data eventreq.on(&#x27;data&#x27;, (chunk) =&gt; &#123; console.log(chunk); body.push(chunk); console.log(body);&#125;);// listen on end eventreq.on(&#x27;end&#x27;, () =&gt; &#123; const parsedBody = Buffer.concat(body).toString(); console.log(parsedBody); // print message=... const message = parsedBody.split(&#x27;=&#x27;)[1]; // get content after = fs.writeFileSync(&#x27;message.txt&#x27;, message);&#125;); The &#39;data&#39; event emits either a Buffer (by default) or a string if setEncoding() was used. In the code above, when the event happens, print out the chunk of this data and push it into an array. The &#39;end&#39; event is emitted when the stream has received an EOF (FIN in TCP terminology). Indicates that no more &#39;data&#39; events will happen. If the stream is also writable, it may be possible to continue writing. In the code above, the data is stored in a text file.","categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"}],"tags":[{"name":"Node.js","slug":"Node-js","permalink":"https://mengqiu.me/tags/Node-js/"},{"name":"Server","slug":"Server","permalink":"https://mengqiu.me/tags/Server/"}]},{"title":"Callback vs Promise vs Async","slug":"Callback-vs-Promise-vs-Async","date":"2022-01-25T19:28:34.000Z","updated":"2022-02-19T17:36:19.807Z","comments":true,"path":"2022/01/25/Callback-vs-Promise-vs-Async/","link":"","permalink":"https://mengqiu.me/2022/01/25/Callback-vs-Promise-vs-Async/","excerpt":"When passing a function to another function as a parameter, the passed function is called callback function. A Promise is a proxy for a value not necessarily known when the promise is created. It allows you to associate handlers with an asynchronous action’s eventual success value or failure reason. This lets asynchronous methods return values like synchronous methods: instead of immediately returning the final value, the asynchronous method returns a promise to supply the value at some point in the future.","text":"When passing a function to another function as a parameter, the passed function is called callback function. A Promise is a proxy for a value not necessarily known when the promise is created. It allows you to associate handlers with an asynchronous action’s eventual success value or failure reason. This lets asynchronous methods return values like synchronous methods: instead of immediately returning the final value, the asynchronous method returns a promise to supply the value at some point in the future. An async function is a function declared with the async keyword, and the await keyword is permitted within it. The async and await keywords enable asynchronous, promise-based behaviour to be written in a cleaner style, avoiding the need to explicitly configure promise chains. To explain these three concepts, we can use example provided in https://www.youtube.com/watch?v=PoRJizFvM7s If we have posts: 1234const posts = [ &#123;title: &#x27;post 1&#x27;, body: &#x27;this is post one&#x27;&#125;, &#123;title: &#x27;post 2&#x27;, body: &#x27;this is post two&#x27;&#125;]; And getPosts function: 123456789function getPosts() &#123; setTimeout(function() &#123; let output = &#x27;&#x27;; posts.forEach((post) =&gt; &#123; output += `&lt;li&gt;$&#123;post.title&#125;&lt;/li&gt;`; &#125;); document.body.innerHTML = output; &#125;, 1000);&#125; Callback example:We can have a function to create post: 123456function createPost(post, callback) &#123; setTimeout(() =&gt; &#123; posts.push(post); callback(); &#125;, 2000);&#125; callback() has to be inside of setTimeout() , otherwise, callback() will run without waiting post.push(). This is the feature of async programming. Then we can trigger createPost() 1createPost(&#123;title: &#x27;post 3&#x27;, body: &#x27;this is post three&#x27;&#125;, getPosts); You will see “post 1” and “post 2” first and then 2 seconds later, “post 3” shows up. Promise example:We can modify createPost to make it return promise: 123456789101112131415function createPost(post) &#123; return new Promise((resolve, reject) =&gt; &#123; // has to have 2 parameters to indicate callback functions to handle resolve and reject setTimeout(() =&gt; &#123; posts.push(post); const error = false; if (!error) &#123; resolve(); &#125; else &#123; reject(&#x27;Error !&#x27;); &#125; &#125;, 2000); &#125;);&#125; Then call the function: 123createPost(&#123; title: &#x27;post 3&#x27;, body: &#x27;this is post three&#x27;&#125;) .then(getPosts) .catch(err =&gt; console.log(err)); This has the same effect as using callback function mentioned above. If we change error to true in createPost , the catch will handle the error, which is console.log. In addition, we can handle multiple promises: 123456789const promise1 = Promise.resolve(&#x27;hello&#x27;);const promise2 = 10;const promise3 = new Promise((resolve, reject) =&gt; setTimeout(resolve, 2000, &#x27;goodbye&#x27;));const promise4 = fetch(&#x27;&#x27;)Promise.all([promise1, promise2, promise3]) .then((values) =&gt; console.log(values)); Result: 1[&#x27;hello&#x27;, 10, &#x27;goodbye&#x27;] Async example:Async function is more elegant. So we don’t need .then() of promise. createPost function is the same as the previous one. Then, we need the keyword async before the function that triggers createPost and getPosts. And put await before the function createPost which needs to be waited until completed. 123456async function init() &#123; await createPost(&#123; title: &#x27;post 3&#x27;, body: &#x27;this is post three&#x27;&#125;); getPosts();&#125;init(); init will start createPost. Once createPost is completed, it will trigger getPosts","categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"}],"tags":[{"name":"Syntax","slug":"Syntax","permalink":"https://mengqiu.me/tags/Syntax/"},{"name":"Async","slug":"Async","permalink":"https://mengqiu.me/tags/Async/"}]},{"title":"Desctructuring object","slug":"Desctructuring-object","date":"2022-01-25T16:53:59.000Z","updated":"2022-02-19T17:13:25.404Z","comments":true,"path":"2022/01/25/Desctructuring-object/","link":"","permalink":"https://mengqiu.me/2022/01/25/Desctructuring-object/","excerpt":"In a destructuring assignment, the value on the righthand side of the equals sign is an array or object (a “structured” value), and the lefthand side specifies one or more variable names using a syntax that mimics array and object literal syntax. When a destructuring assignment occurs, one or more values are extracted (“destructured”) from the value on the right and stored into the variables named on the left.","text":"In a destructuring assignment, the value on the righthand side of the equals sign is an array or object (a “structured” value), and the lefthand side specifies one or more variable names using a syntax that mimics array and object literal syntax. When a destructuring assignment occurs, one or more values are extracted (“destructured”) from the value on the right and stored into the variables named on the left. 123456let [x,y] = [1,2];console.log(x,y); // print 1 2[x,y] = [y,x]console.log(x,y); // print 2 1[x,y] = [x+1, y+1];console.log(x,y); // print 3 2 123456789const o = &#123; x: 1, y: 2 &#125;;console.log(Object.entries(o)); // print [[&#x27;x&#x27;, 1], [&#x27;y&#x27;, 2]]for (const [name, value] of Object.entries(o)) &#123; console.log(name, value);&#125; // print x 1 and y 2let &#123;x, y&#125; = o; // extract from object oconsole.log(x); // 1console.log(y); // 2 Destructuring function parameter To extract attribute from object in function parameter: 12345678const person = &#123; name: &#x27;max&#x27;, age: 29&#125;;const getName = function (&#123; name &#125;) &#123; console.log(name);&#125;getName(person); // print &#x27;max&#x27;","categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"}],"tags":[{"name":"Syntax","slug":"Syntax","permalink":"https://mengqiu.me/tags/Syntax/"}]},{"title":"Spread and rest operator","slug":"Spread-and-rest-operator","date":"2022-01-24T16:24:08.000Z","updated":"2022-02-19T17:12:10.104Z","comments":true,"path":"2022/01/24/Spread-and-rest-operator/","link":"","permalink":"https://mengqiu.me/2022/01/24/Spread-and-rest-operator/","excerpt":"Spread operator ... is used to unpack or “spread out” the elements of an array (or any other iterable object, such as string) in a context where individual values are expected.Rest operator ... is used to pack arguments of a function.","text":"Spread operator ... is used to unpack or “spread out” the elements of an array (or any other iterable object, such as string) in a context where individual values are expected.Rest operator ... is used to pack arguments of a function. 1234let s = &quot;4213&quot;;const arr = [4,2,1,3];console.log(Math.min(...s)); // print 1console.log(Math.min(...arr)); // print 1 Rest operator ... is used to write functions that can be invoked with arbitrarily more arguments than parameters. 12345678910111213function max(first=-Infinity, ...rest) &#123; let maxValue = first; // Start by assuming the first arg is biggest // Then loop through the rest of the arguments, looking for bigger for(let n of rest) &#123; if (n &gt; maxValue) &#123; maxValue = n; &#125; &#125; // Return the biggest return maxValue;&#125;max(1, 10, 100, 2, 3, 1000, 4, 5, 6) // =&gt; 1000 The spread operator for function call When we use ... in function definition, it has the opposite effect to the spread operator. Using ... in a function definition gathers multiple function arguments into an array. Rest parameters and the spread operator are often useful together 12345function f (...args) &#123; console.log (args);&#125;f(1,2,3,4); // print &quot;[1,2,3,4]&quot; 1234567891011function f (innerf) &#123; return function (...arg) &#123; // ...arg is the arguments passed to f(innerf) return innerf(...arg); &#125;&#125;function innerf(...x) &#123; console.log(...x);&#125;f(innerf)(1,2,3,4); // print &quot;1 2 3 4&quot;","categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"}],"tags":[{"name":"Syntax","slug":"Syntax","permalink":"https://mengqiu.me/tags/Syntax/"}]},{"title":"JavaScript function","slug":"JavaScript-function","date":"2022-01-24T07:07:25.000Z","updated":"2022-02-19T17:13:17.172Z","comments":true,"path":"2022/01/24/JavaScript-function/","link":"","permalink":"https://mengqiu.me/2022/01/24/JavaScript-function/","excerpt":"JS functions are parameterized. They have a list of identifiers, known as parameters, that work as local variables for the body of the function. In addition to the arguments, each invocation has another value — the invocation context: the value of this keyword. It’s a good idea to use const for function name. Function defined with expressions can’t be invoked before they are defined.","text":"JS functions are parameterized. They have a list of identifiers, known as parameters, that work as local variables for the body of the function. In addition to the arguments, each invocation has another value — the invocation context: the value of this keyword. It’s a good idea to use const for function name. Function defined with expressions can’t be invoked before they are defined. Example: 1234567891011console.log(hello1());console.log(hello2());function hello1 () &#123; console.log(&quot;hello world&quot;);&#125;;// hello2 will throw exception as it&#x27;s called before initializationconst hello2 = function () &#123; console.log(&quot;hello world&quot;);&#125;; In short, with arrow functions there are no binding of this. In regular functions the this keyword represented the object that called the function, which could be the window, the document, a button or whatever. With arrow functions the this keyword always represents the object that defined the arrow function. 1234567891011121314151617181920window.name = &quot;global&quot;; // In nodejs, there&#x27;s no global variable called windowvar person = &#123; name: &quot;jason&quot;, shout: function () &#123; console.log(&quot;my name is &quot;, this.name); &#125;, shout2: () =&gt; &#123; console.log(&quot;my name is &quot;, this.name); &#125;, // Shorter syntax shout3() &#123; console.log(&quot;my name is &quot;, this.name); &#125;&#125;;person.shout(); // &quot;jason&quot;person.shout2(); // &quot;global&quot;person.shout3(); // &quot;jason&quot;","categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"}],"tags":[{"name":"Syntax","slug":"Syntax","permalink":"https://mengqiu.me/tags/Syntax/"}]}],"categories":[{"name":"JavaScript","slug":"javascript","permalink":"https://mengqiu.me/categories/javascript/"},{"name":"API","slug":"API","permalink":"https://mengqiu.me/categories/API/"},{"name":"Java","slug":"Java","permalink":"https://mengqiu.me/categories/Java/"},{"name":"Project","slug":"Project","permalink":"https://mengqiu.me/categories/Project/"}],"tags":[{"name":"TypeScript","slug":"TypeScript","permalink":"https://mengqiu.me/tags/TypeScript/"},{"name":"VSCode","slug":"VSCode","permalink":"https://mengqiu.me/tags/VSCode/"},{"name":"Node.js","slug":"Node-js","permalink":"https://mengqiu.me/tags/Node-js/"},{"name":"Email","slug":"Email","permalink":"https://mengqiu.me/tags/Email/"},{"name":"Authentication","slug":"Authentication","permalink":"https://mengqiu.me/tags/Authentication/"},{"name":"Security","slug":"Security","permalink":"https://mengqiu.me/tags/Security/"},{"name":"MongoDB","slug":"MongoDB","permalink":"https://mengqiu.me/tags/MongoDB/"},{"name":"Mongoose","slug":"Mongoose","permalink":"https://mengqiu.me/tags/Mongoose/"},{"name":"Database","slug":"Database","permalink":"https://mengqiu.me/tags/Database/"},{"name":"Sequelize","slug":"Sequelize","permalink":"https://mengqiu.me/tags/Sequelize/"},{"name":"Routing","slug":"Routing","permalink":"https://mengqiu.me/tags/Routing/"},{"name":"MVC","slug":"MVC","permalink":"https://mengqiu.me/tags/MVC/"},{"name":"API","slug":"API","permalink":"https://mengqiu.me/tags/API/"},{"name":"OAuth","slug":"OAuth","permalink":"https://mengqiu.me/tags/OAuth/"},{"name":"Spring boot","slug":"Spring-boot","permalink":"https://mengqiu.me/tags/Spring-boot/"},{"name":"Server","slug":"Server","permalink":"https://mengqiu.me/tags/Server/"},{"name":"IPv4","slug":"IPv4","permalink":"https://mengqiu.me/tags/IPv4/"},{"name":"REST","slug":"REST","permalink":"https://mengqiu.me/tags/REST/"},{"name":"Syntax","slug":"Syntax","permalink":"https://mengqiu.me/tags/Syntax/"},{"name":"Async","slug":"Async","permalink":"https://mengqiu.me/tags/Async/"}]}